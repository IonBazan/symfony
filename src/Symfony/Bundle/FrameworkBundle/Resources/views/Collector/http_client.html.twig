{% extends '@WebProfiler/Profiler/layout.html.twig' %}

{% block toolbar %}
    {% if collector.traces|length %}
        {% set icon %}
            {{ include('@Framework/Icon/http-client.svg') }}
            {% set status_color = '' %}
            <span class="sf-toolbar-value">{{ collector.traces|length }}</span>
        {% endset %}

        {{ include('@WebProfiler/Profiler/toolbar_item.html.twig', { link: profiler_url, status: status_color }) }}
    {% endif %}
{% endblock %}

{% block menu %}
<span class="label {{ collector.traces is empty ? 'disabled' }}">
    <span class="icon">{{ include('@Framework/Icon/http-client.svg') }}</span>
    <strong>HTTP Client</strong>
</span>
{% endblock %}

{% block panel %}
    <h2>HTTP Requests</h2>
    {% for trace in collector.traces %}
        <table>
            <thead>
                <tr>
                    <th colspan="2">
                        <span class="label">{{ trace.request.method }}</span> {{ trace.request.url }}
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th nowrap>Response Status Code</th>
                    <td>
                        {% if trace.response.statusCode >= 500 %}
                            {% set responseStatus = 'error' %}
                        {% elseif trace.response.statusCode >= 400 %}
                            {% set responseStatus = 'warning' %}
                        {% else %}
                            {% set responseStatus = 'success' %}
                        {% endif %}
                        <span class="label status-{{ responseStatus }}">
                            {{ trace.response.statusCode }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <th nowrap>Response Headers</th>
                    <td>
                        {% for header in trace.response.headers %}
                            <div>{{ header }}</div>
                        {% endfor %}
                    </td>
                </tr>
                <tr>
                    <th nowrap>Options</th>
                    <td>
                        {{ trace.request.options is empty ? 'none' : profiler_dump(trace.request.options, maxDepth=1) }}
                    </td>
                </tr>
            </tbody>
        </table>
    {% else %}
        <div class="empty">
            <p>No HTTP requests have been made.</p>
        </div>
    {% endfor %}
{% endblock %}
